| âœï¸ Tangxt | â³ 2020-08-11 | ğŸ·ï¸ æ€»çº² |

# 01-Node.js æŠ€æœ¯æ¶æ„

> Node.js æ˜¯ä»€ä¹ˆï¼Œä»¥åŠå®ƒæ˜¯ç”±ä»€ä¹ˆç»„æˆçš„ï¼ -> å¯¹äºå‰ç«¯è€Œè¨€ï¼Œå…³äºåº•å±‚ C++ä»£ç ï¼Œåªéœ€è¦çŸ¥é“æ˜¯åšä»€ä¹ˆçš„ï¼Œä»¥åŠç”¨åˆ°äº†å“ªäº›æŠ€æœ¯å°±è¡Œäº†ï¼ä¸éœ€è¦å»æƒ³è¿™ä»£ç çš„é€»è¾‘æ˜¯æ€æ ·çš„â€¦â€¦

## â˜…å¼•å­

æˆ‘å…ˆçœ‹äº†è¿™ä¸ª [Node.js åŸºç¡€ç¯‡](https://ppambler.github.io/nodejs/02/) ï¼ˆå°±çœ‹äº†è§†é¢‘çš„ç¬¬ä¸€è®²ï¼‰ï¼Œä½†çœ‹å®Œä¹‹åï¼Œæˆ‘è§‰å¾—è¿™äº›çŸ¥è¯†ç‚¹éƒ½æ˜¯å¾ˆé›¶ç¢çš„ï¼Œè™½ç„¶å†…å®¹éƒ½è®²æ¸…æ¥šäº†ï¼Œä½†æ€»è§‰å¾—è‡ªå·±çš„è„‘æµ·é‡Œå¹¶å’©æœ‰å¯¹ Node.js å»ºç«‹èµ·ä¸€ä¸ªæ€»ä½“æ€§çš„è®¤çŸ¥ï¼Œäºæ˜¯æˆ‘å°±çœ‹äº†æ–¹æ–¹è¿™èŠ‚çš„å…è´¹è¯¾ï¼š[Node.js å…¨è§£åŠ Next.js æ¡†æ¶å®è·µ - å†™ä»£ç å•¦ï¼](https://xiedaimala.com/courses/f0e0726e-6073-4b23-b590-387ff879f64a/random/1a2196ecc6#/common)

## â˜…JS å¦‚ä½•è°ƒç”¨ C++

1ï¼‰Node.js ç‰ˆæœ¬

åŒæ•°æ˜¯ç¨³å®šç‰ˆï¼Œå•æ•°æ˜¯éç¨³å®šç‰ˆï¼Œæˆ‘ä»¬ä½¿ç”¨ 8 ä»¥ä¸Šç‰ˆæœ¬

> Vue 3.0 åœ¨ 8 é‡Œç”¨ä¼šæœ‰äº›å°é—®é¢˜ï¼Œè€Œ 10 å°±æ²¡é—®é¢˜äº†ï¼

2ï¼‰Node.js å®‰è£…

![å®‰è£…](assets/img/2020-08-11-23-55-18.png)

3ï¼‰å‘¨è¾¹å·¥å…·

![å¼€å‘å·¥å…·](assets/img/2020-08-11-23-59-27.png)

4ï¼‰Node.js æ˜¯ä»€ä¹ˆï¼Ÿ

> è®² Node.js æ˜¯ä»€ä¹ˆä¹‹å‰ï¼Œå…ˆæ¥è®²è®² Node.js ä¸æ˜¯ä»€ä¹ˆâ€¦â€¦

1ã€Node.js ä¸æ˜¯ä»€ä¹ˆï¼Ÿ

- **ä¸æ˜¯ Web æ¡†æ¶**
  - Node.js å¹¶ä¸æ˜¯ web åç«¯æ¡†æ¶
  - æ‰€ä»¥ä½ ä¸èƒ½æŠŠ Node.js ä¸ Flask æˆ– Spring å¯¹æ¯”
- **ä¸æ˜¯ç¼–ç¨‹è¯­è¨€**
  - Node.js å¹¶ä¸æ˜¯åç«¯çš„ JS
  - æ‰€ä»¥ä½ ä¸èƒ½æŠŠ Node.js ä¸ Python æˆ– PHP å¯¹æ¯”

> ä¸è¦æœ‰è¿™æ ·çš„è¯´è¾ã€Œæˆ‘è¯¥å­¦ Node.js å¥½å‘¢ï¼Ÿè¿˜æ˜¯ Python å¥½å‘¢ï¼Ÿã€

2ã€Node.js æ˜¯ä»€ä¹ˆï¼Ÿ

- **æ˜¯ä¸€ä¸ªå¹³å°**
  - å®ƒå°†å¤šç§æŠ€æœ¯ç»„åˆèµ·æ¥äº†
  - è®© JavaScript ä¹Ÿèƒ½è°ƒç”¨ç³»ç»Ÿæ¥å£ã€å¼€å‘åç«¯åº”ç”¨
- Node.js ç”¨åˆ°äº†å“ªäº›æŠ€æœ¯ï¼Ÿ
  - V8 å¼•æ“ -> ä½œè€…å¾ˆç‰›é€¼ï¼ŒV1~V8 è¿™ 8 ä¸ªè™šæ‹Ÿæœºï¼Œè€Œä¸”è¿™æ˜¯ä¸åŒè¯­è¨€çš„
  - libuv -> éå¸¸æœ‰ç”¨çš„åº“ï¼Œæœ¬æ¥æ˜¯ Node.js ä½œè€…å†™ç»™è‡ªå·±ç”¨çš„ï¼Œåæ¥å› ä¸ºæ­¤åº“å¤ªæœ‰ç”¨äº†ï¼Œæ‰€ä»¥å¯¼è‡´äº†å…¶å®ƒè¯­è¨€ç¤¾åŒºä¹Ÿåœ¨ç”¨è¿™ä¸ªåº“
  - C/C++ å®ç°çš„å„ç§é«˜æ€§èƒ½çš„åº“ï¼š [c-ares](https://c-ares.haxx.se/)ã€Œå®ç° DNS è§£æï¼ŒåŸŸåçš„è§£æã€ã€[http-parser](https://github.com/nodejs/http-parser)ã€Œè§£æ httpã€ã€[OpenSSL](https://www.openssl.org/)ã€Œæ httpsã€ã€[zlib](http://zlib.net/)ã€ŒæåŠ å¯†ã€ç­‰åº“

> æˆ‘ä»¬ä¸€èˆ¬ä¸åŒºåˆ† C å’Œ C++ï¼Œå› ä¸ºå®ƒä»¬ä¿©éƒ½æ˜¯å¯ä»¥é€šç”¨çš„ï¼Œè¯´ç”¨ C å®ç°çš„é«˜æ€§èƒ½åº“ä¹Ÿå¥½ï¼Œè¿˜æ˜¯ç”¨ C++å®ç°çš„é«˜æ€§èƒ½åº“ä¹Ÿç½¢ï¼

5ï¼‰Node.js æŠ€æœ¯æ¶æ„

![Node.js æŠ€æœ¯æ¶æ„](assets/img/2020-08-12-10-37-00.png)

- [0.10 ç‰ˆæœ¬](https://github.com/nodejs/node/tree/v0.10.0-release)
- [node ä»£ç åˆ†æ](https://github.com/yjhjstz/deep-into-node)ï¼šä½œè€…ç”¨äº†å¤šç¯‡æ–‡ç« åˆ†æäº† Node.js çš„æ ¸å¿ƒæ¶æ„ -> è®²å¾—éå¸¸è¯¦ç»†

æ¥ä¸‹æ¥ï¼Œå°±ä»‹ç»ä¸€ä¸‹è¯¥æ¶æ„å›¾é‡Œè¾¹æåˆ°çš„ä¸€ä¸ªä¸ªä¸œè¥¿ï¼

6ï¼‰ä»€ä¹ˆæ˜¯ bindingsï¼Ÿ

![bindings æ˜¯ä»€ä¹ˆ](assets/img/2020-08-12-14-54-39.png)

Node.js å®ƒè°ƒç”¨äº†å¾ˆå¤š C/C++çš„åº“ï¼Œæ¯”å¦‚è¯´ C++ æœ‰ä¸€ä¸ªåº“ï¼Œå« http_parserï¼Œå®ƒå¯ä»¥éå¸¸é«˜æ•ˆåœ°å¤„ç† http çš„ä¸€äº›å†…å®¹ï¼Œå¦‚å®ƒå‘Šè¯‰ä½ è¿™éƒ¨åˆ†æ˜¯å•¥ï¼Œä¸‹ä¸€éƒ¨åˆ†æ˜¯å•¥ï¼Œæ¯éƒ¨åˆ†éƒ½æœ‰å•¥å«ä¹‰ç­‰ç­‰â€¦â€¦

è€Œæˆ‘ä»¬åœ¨ Node.js é‡Œï¼Œåªèƒ½å†™ JS å‘€ï¼æ‰€ä»¥æˆ‘ä»¬è¯¥å¦‚ä½•è°ƒç”¨ C/C++çš„åº“å‘¢ï¼Ÿ

ç›´æ¥è°ƒï¼Ÿ -> æ˜¾ç„¶ä¸è¡Œå‘€ï¼JS çš„æ•°æ®ç±»å‹ä¸ C++çš„æ•°æ®ç±»å‹æ ¹æœ¬å°±ä¸ä¸€æ · -> æ‰€ä»¥è¿™æ ¹æœ¬å°±ä¸å­˜åœ¨ä¸€ç§ç›´æ¥è°ƒç”¨çš„é€”å¾„

é‚£å’‹åŠå‘¢ï¼Ÿ

Node.js ä½œè€…åšäº†ä¸€äº›ä¸­é—´å±‚çš„å¤„ç†ï¼Œå°è£…äº†ä¸€äº›ä¸œè¥¿ï¼Œå¦‚ç”¨ C++ï¼ˆå¿…é¡»ç”¨è¿™é—¨è¯­è¨€ï¼‰å¯¹ http_parser è¿›è¡Œå°è£…ï¼Œä½¿å…¶èƒ½è®© JS çš„æ•°æ®ç±»å‹ä¸ C++çš„æ•°æ®ç±»å‹ç»Ÿä¸€åŒ–ï¼Œå¦‚ä¸ç®¡æ˜¯`int/short/floatâ€¦â€¦`è¿˜æ˜¯å•¥çš„ï¼Œéƒ½æ˜¯`number`ç±»å‹ï¼Œéƒ½æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚

å°è£…çš„ç»“æœå°±æ˜¯ã€Œ`http_parser_bindings.cpp`ã€ï¼ˆè¿˜æœ‰å…¶å®ƒå¤´æ–‡ä»¶ï¼‰

æ€»ä¹‹ï¼ŒNode.js ä½œè€…ä¸ºäº†è®©æˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨ `http_parser`ï¼Œæ‰€ä»¥å°±å†™äº†ä¸€ä¸ª `http_parser_bindings.cpp`

é™¤æ­¤ä¹‹å¤–ï¼ŒNode.js è¿˜æä¾›äº†ä¸€ä¸ªç¼–è¯‘å·¥å…·ï¼Œå¯ä»¥æŠŠ `http_parser_bindings.cpp` ç¼–è¯‘æˆ `.node`è¿™æ ·çš„äºŒè¿›åˆ¶æ–‡ä»¶æˆ–è€…å¯æ‰§è¡Œæ–‡ä»¶

æˆ‘ä»¬çš„ JS ä¸èƒ½ç›´æ¥ require `.cpp`æ–‡ä»¶ï¼Œä½†å¯ä»¥ require `.node`æ–‡ä»¶ï¼Œè¿™æ ·ä¸€æ¥ï¼ŒJS å°±èƒ½è°ƒç”¨ C++åº“äº†ï¼Œè€Œ Node.js ä½œè€…å†™çš„è¿™ä¸ª`http_parser_bindings.cpp`å°±å«åšã€Œbindingã€å•¦ï¼

Node.js ä½œè€…é™¤äº†å°è£… `http_parser` è¿™ä¸ªåº“ä»¥å¤–ï¼Œè¿˜å°è£…äº†å…¶å®ƒåº“ï¼Œä¹Ÿå°±æ˜¯ Node.js è¿˜æä¾›äº†å¾ˆå¤šä¸ª`binding`ï¼Œæ‰€ä»¥è¿™å°±æ˜¯ã€Œ`bindings`ã€äº†ï¼

ç”±äºæ˜¯ Node.js æä¾›çš„ bindingï¼Œæ‰€ä»¥å…¨åå°±æ˜¯ã€Œ**Node.js bindings**ã€

å›è¿‡å¤´æ¥çœ‹ï¼ŒNode.js æ˜¯å¦‚ä½•ä½¿ JS å’Œ C/C++ é€šä¿¡çš„å‘¢ï¼Ÿ

> Node.js åœ¨è¿™ä¸­é—´åŠ äº†ä¸€ä¸ªä¸ª C++ æ¨¡å—ï¼Œå®ƒå¯ä»¥ä½¿å¾—è¿™ä¸¤è€…ä¹‹é—´åœ¨æ•°æ®ç±»å‹ä¸Šç»Ÿä¸€ï¼Œä»¥åŠå…¶å®ƒæ–¹é¢çš„ä¸€äº›åè°ƒï¼

7ï¼‰JS ä¸ C++äº¤äº’

> Node.js è¿˜æä¾›äº†å…¶å®ƒäº¤äº’æ–¹å¼ï¼Œæˆ‘è¿™é‡Œåªä¸¾å…¶ä¸­çš„ä¸€ä¸ªä¾‹å­

- JS è°ƒç”¨ C++ä»£ç ï¼š [å®˜æ–¹ç¤ºä¾‹ 1](http://nodejs.cn/api/addons.html#addons_function_arguments)
- C++è°ƒç”¨ JS å›è°ƒï¼š[å®˜æ–¹ç¤ºä¾‹ 2](http://nodejs.cn/api/addons.html#addons_callbacks)

å¦‚ä½•ç”¨ JS è°ƒç”¨ C++ï¼ˆè‡ªé¡¶å‘ä¸‹ï¼‰ï¼Ÿå¦‚ä½•ç”¨ C++è°ƒç”¨ JS çš„å‡½æ•°ï¼ˆè‡ªåº•å‘ä¸Šï¼‰ï¼Ÿ

1ã€ç¤ºä¾‹ 1

ä¸Šè¿°ç¤ºä¾‹ 1 é‡Œè¾¹çš„å†…å®¹æ˜¯ Node.js çš„æ’ä»¶å†…å®¹â€”â€”**å‘Šè¯‰æˆ‘ä»¬å¦‚ä½•å†™ä¸€ä¸ª C++çš„åº“ï¼Œä»¥åŠå¦‚ä½•ç”¨ JS è°ƒç”¨è¿™ä¸ªåº“ï¼**

å¦‚ä½ å†™äº†ä¸€ä¸ª `addon.cc`ï¼ˆä¸å®Œå…¨æ˜¯ C ä»£ç ï¼Œå¤¹æ‚ç€ C++ä»£ç ï¼Œæ‰€ä»¥å°±è¯´æˆæ˜¯`C/C++`äº†ï¼‰ -> ç¼–è¯‘å®ƒ -> å¾—åˆ°`.node`æ–‡ä»¶ -> åœ¨ JS é‡Œä½¿ç”¨å®ƒ`const addon = require('./build/Release/addon')`ï¼ˆå¯ä»¥çœç•¥`.node`åç¼€ï¼‰

æˆ‘ä»¬

``` js
addon.add(3, 5)
```

ï¼Œå…¶å®å°±æ˜¯åšï¼š

``` c++
// add æ–¹æ³•çš„å®ç°
// args æ˜¯ä½ ä¼ ç»™ C++çš„å‚æ•°æ•°ç»„ï¼Œä¹Ÿå°±æ˜¯ç±»ä¼¼ [3,5] è¿™ç§å½¢å¼
void Add(const FunctionCallbackInfo<Value>& args) {
  // å¦‚æœä½ åªä¼ ä¸€ä¸ªå‚æ•°å°±æŠ¥ã€Œå‚æ•°çš„æ•°é‡é”™è¯¯ã€è¿”å›ç»™ä½  JS
  // å¦‚æœä½ ä¼ çš„ä¸æ˜¯ Number ç±»å‹çš„ï¼Œé‚£å°±æŠ¥ã€Œå‚æ•°é”™è¯¯ã€è¿”å›ç»™ä½  JS
  // ä¸¤ä¸ªæ£€æŸ¥éƒ½é€šè¿‡äº†ï¼Œé‚£å°±æŠŠä¿©å‚æ•°åŠ èµ·æ¥ï¼Œå¾—åˆ°äº†ä¸€ä¸ªæ–°çš„ Number ç±»å‹çš„å€¼ï¼Œç„¶åè¿”å›ç»™ä½  JSï¼Œè¿™æ · addon.add(3, 5) å°±æ˜¯ä¸€ä¸ª ã€Œ8ã€çš„è¿”å›å€¼
}
```

> çªç„¶æ„Ÿè§‰ï¼ŒæŠŠ JS æ•°å€¼ç±»å‹çš„ `3` å’Œ `5` ï¼Œç»è¿‡ `binding` **åŠ å·¥**åï¼Œå˜æˆäº† C/C++ å¯å¤„ç†çš„ç±»å‹ï¼ŒC/C++ å¤„ç†ä¹‹åï¼Œè¿”å›äº†ä¸€ä¸ª  `double` ç±»å‹çš„ `8`ï¼Œç„¶åå†æŠŠ `8` è¿™ä¸ªå€¼é€šè¿‡ `binding` **è¿‡æ»¤**æˆ JS å¯ä»¥å¤„ç†çš„ `Number`ç±»å‹ `8`

æˆ‘çœ‹äº†ä¸€ä¸‹è¿™ä¸ªï¼š

```c++
void Add(const FunctionCallbackInfo<Value>& args) {
   // æ‰§è¡Œæ“ä½œ
  double value =
      args[0].As<Number>()->Value() + args[1].As<Number>()->Value();
  Local<Number> num = Number::New(isolate, value);

  // è®¾ç½®è¿”å›å€¼ ï¼ˆä½¿ç”¨ä¼ å…¥çš„ FunctionCallbackInfo<Value>&)ã€‚
  args.GetReturnValue().Set(num);
}
```

ä¼¼ä¹ `Local<Number> num = Number::New(isolate, value);` è¿™ä¸€æ­¥å°±å®Œæˆäº†`double` `8` çš„æ•°æ®ç±»å‹è½¬æ¢â€¦â€¦ï¼ˆ`isolate`å¾ˆå¤æ‚ï¼‰

ä¸ç®¡æ€æ ·ï¼Œæ€»ä½“ä¸Šçœ‹ï¼Œ`addon.add(3, 5)`å°±æ˜¯åœ¨è°ƒç”¨`addon.cc`é‡Œçš„`Add`å‡½æ•°ï¼ˆä»¥åå¦‚æœä½ æƒ³äº†è§£`add`è¿™ä¸ªå‡½æ•°æ˜¯æ€ä¹ˆå†™çš„ï¼Œé‚£ä¹ˆä½ å°±å¾—çœ‹åº•å±‚çš„`.cc`æ–‡ä»¶äº†ï¼ -> å…³äºå¯¹è±¡ä¹‹é—´çš„é€šä¿¡ï¼š`addon`è¦åšåŠ æ³•è¡Œä¸ºï¼Œè¢«æ“ä½œçš„å¯¹è±¡æ˜¯`3`å’Œ`5` -> `you.cut('hand')`åŒåä¸€ä½ è¦å‰æ‰‹ï¼Œè¡Œä¸ºæ˜¯ã€Œå‰ã€ï¼Œè¦ã€Œå‰ã€çš„å¯¹è±¡æ˜¯ã€Œæ‰‹ã€ï¼Œè€Œä¸æ˜¯ã€Œè„šã€ï¼‰

---

å¯ä»¥çœ‹åˆ°è¿™ä¸ªä¾‹å­æ˜¯å¯ä»¥è¯æ˜ JS æ˜¯å¯ä»¥ç›´æ¥è°ƒç”¨ C++çš„ä»£ç çš„ï¼ï¼ˆä¸æ­¢æ˜¯è¿™ä¸€ç§æ–¹æ³•å¯ä»¥åšåˆ°ï¼æ–¹æ–¹æ¼”ç¤ºçš„æ˜¯æ–‡æ¡£é‡Œå†™çš„æ–¹æ³•ï¼‰

---

2ã€ç¤ºä¾‹ 2

C++ å¦‚ä½•è°ƒç”¨ JS é‡Œçš„å‡½æ•°ï¼Ÿ

> æŠŠ JavaScript å‡½æ•°ä¼ å…¥åˆ°ä¸€ä¸ª C++ å‡½æ•°å¹¶åœ¨é‚£é‡Œæ‰§è¡Œå®ƒä»¬ï¼Œè¿™åœ¨æ’ä»¶é‡Œæ˜¯å¸¸è§çš„åšæ³•ã€‚

``` js
// test.js
const addon = require('./build/Release/addon');

addon((msg) => {
  console.log(msg);
// æ‰“å°ï¼š'hello world'
});
```

æˆ‘ä»¬æŠŠä¸€ä¸ª callback ä½œä¸ºä¸€ä¸ªå‚æ•°ä¼ ç»™äº†`addon`ï¼Œæˆ‘ä»¬ JS å¹¶å’©æœ‰è°ƒç”¨`callback`ï¼

![callback](assets/img/2020-08-12-17-10-11.png) 

C++å†…å­˜é‡Œçš„`String`ä¸ JS çš„æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥éœ€è¦æ„é€ è½¬åŒ–ä¸€ä¸‹â€¦â€¦ææˆæ˜¯ JS èƒ½çœ‹æ‡‚çš„`String`

C++åº•å±‚çš„`addon`æ‰§è¡Œï¼Œå…¶å‡½æ•°ä½“å†…`cb -> Call("hello world")` -> ä¹Ÿå°±æ˜¯æŠŠ`"hello world"`ä¼ ç»™äº†ä¸Šå±‚çš„`(msg) => {console.log(msg)}`å»è°ƒç”¨ -> è¯´ç™½äº†ï¼Œå°±æ˜¯åº•å±‚æŠ›ä¸€ä¸ªæ•°æ®ç»™ä¸Šå±‚çš„`msg`

> ä¸€ä¸ªç–‘é—®ï¼šæ˜¯åº•å±‚å°±æ‰§è¡Œäº†`callback`ï¼Œ`log`ä¸€ä¸ª`"hello world"`ï¼Œè¿˜æ˜¯ æŠŠæ•°æ®æŠ›ç»™ä¸Šå±‚çš„ JSï¼Œç„¶åäº¤ç»™ `v8` å¼•æ“è‡ªå·±å»æ‰§è¡Œ `callback`ï¼Ÿ

æˆ‘è§‰å¾—æ˜¯åœ¨åº•å±‚è°ƒçš„`callback`ï¼æ¯•ç«Ÿ`addon`è¿™ä¸ªå‡½æ•°æ˜¯ C/C++ å†™çš„ï¼ -> ä¼¼ä¹ V8 å¼•æ“å°±æ˜¯ C/C++ å†™çš„ï¼Œæ‰€ä»¥æ‰§è¡Œ C/C++ ä»£ç æ—¶ï¼Œåº”è¯¥ä¹Ÿæ˜¯ç”± V8 å¼•æ“åšçš„å§â€¦â€¦

> é¢ï¼Œæˆ‘ä¼¼ä¹é—å¿˜äº† Node.js æä¾›çš„**ç¼–è¯‘å·¥å…·**ï¼Œæˆ‘ä»¬ä¸º Node.js å†™ C/C++ æ’ä»¶ï¼Œå…¶å®å¾—è¦æŒ‰ç…§æŸç§è¦æ±‚æ¥å†™ï¼Œç¼–è¯‘å·¥å…·æŠŠå†™å¥½çš„`xxx_binding.cpp`æ–‡ä»¶ç¼–è¯‘æˆå¯ä¾› V8 å¼•æ“æ‰§è¡Œçš„ `.node` æ–‡ä»¶â€¦â€¦ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬çœ‹ `.cpp` ä»£ç  å°±æ˜¯åœ¨çœ‹æŸä¸ªå‡½æ•°æ˜¯æ€ä¹ˆå†™çš„â€¦â€¦çœŸæ­£çš„ä»£ç æ‰§è¡Œè¿˜æ˜¯äº¤ç»™äº† V8 å¼•æ“ï¼æˆ‘ä»¬ä¹‹æ‰€ä»¥èƒ½è®© Node.js ä½¿ç”¨å…¶å®ƒ C/C++ å†™çš„é«˜æ€§èƒ½çš„åº“ï¼Œé‚£æ˜¯å› ä¸ºæˆ‘ä»¬ã€Œå°è£…äº†ä¸€ä¸ªä¸ª`xxx_binding.cpp`ï¼ˆå¾—ç¬¦åˆæŸç§è¦æ±‚å»å†™ï¼Œå¦‚éœ€è¦å¤„ç†ä¸€ä¸‹ç±»å‹é…å¯¹çš„é—®é¢˜ï¼‰+ç¼–è¯‘å·¥å…·ï¼ˆæŠŠ`xxx_binding.cpp`ç¼–è¯‘æˆ V8 å¼•æ“å¯æ‰§è¡Œçš„æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ä¼ ç»Ÿçš„æŠŠ`.cpp`äº¤ç»™`C++`ç¼–è¯‘å™¨å»æï¼‰ã€ -> æˆ‘ä»¬è¯´çš„ ã€ŒC/C++ æ‰©å±•ã€å°±æ˜¯ `xxx_binding.cpp`ï¼Œè€Œã€Œç¼–è¯‘è¿‡çš„ C/C++ æ‰©å±•ã€ï¼Œä¹Ÿå°±æ˜¯ V8 å¼•æ“èƒ½æ‰§è¡Œçš„ `xxx.node` -> æ–‡ä»¶åï¼š`addon.cc -> addon.node` -> **æ‰€è°“çš„é«˜æ€§èƒ½çš„åº“ï¼Œæˆ‘æƒ³åº”è¯¥æ˜¯è¿™ä¸ªåº“çš„ä»£ç å†™å¾—éå¸¸å¥½å§ï¼è€Œä¸æ˜¯å› ä¸ºç”¨äº† C/C++** -> ç–‘é—®ï¼šNode.js æä¾›çš„ç¼–è¯‘å·¥å…·çœŸå¾—æŠŠæ‰€æœ‰çš„ C/C++ ä»£ç éƒ½ç»™ç¼–è¯‘æˆ `xxx.node`ï¼Œç„¶åäº¤ç»™ V8 å¼•æ“å»æ‰§è¡Œï¼Ÿéš¾é“å°±æ²¡æœ‰å…¶å®ƒçº¿ç¨‹å»ç¼–è¯‘æ‰§è¡Œ C/C++ å†™çš„ä»£ç ï¼Ÿ

---

è¯è¯´ï¼Œæˆ‘å†™ Node.js ï¼Œè¿˜è¦ä¼š C++ å—ï¼Ÿ

ä¸ç”¨ä¼šï¼Œä½ **åªè¦çŸ¥é“ JS å’Œ C/C++ æ˜¯å¦‚ä½•äº¤äº’çš„å°±è¡Œäº†** -> å¤§éƒ¨åˆ†äººå†™ Node.js æ˜¯ä¸éœ€è¦ä¼š C++çš„ï¼Œè€Œä¸”å¯¹äºæ–¹æ–¹æ¥è¯´ï¼Œæ–¹æ–¹ä¹Ÿä¸ä¼šå†™ C++ä»£ç ï¼Œåªæ˜¯èƒ½çœ‹æ‡‚ï¼Œèƒ½çœ‹æ‡‚ C++ ä»£ç åœ¨åšä»€ä¹ˆâ€¦â€¦

---

Node.js è¿˜æä¾›äº†å…¶å®ƒäº¤äº’æ–¹å¼ -> **åªè¦ä½ èƒ½è®© JS å»è°ƒç”¨ C++ è¿™ä»¶äº‹åšå¥½äº†ï¼Œé‚£ä¹ˆ JS çš„èƒ½åŠ›å°±ä¼šè¢«æ— é™æ‰©å¤§**

---

8ï¼‰C/C++ æ’ä»¶ï¼ˆè‡ªå®šä¹‰å…¶å®ƒèƒ½åŠ›ï¼‰

æˆ‘ä»¬çŸ¥é“ Node.js bindings çš„å­˜åœ¨ å°±æ˜¯ä¸ºäº†è®© JS å’Œ C/C++é€šä¿¡ -> Node.js bindings è¿™ä¸ªèƒ½åŠ›ä½¿å¾— Node.js çš„èƒ½åŠ›å¤§å¤§çš„è¢«æ‰©å±•äº†â€¦â€¦

é‚£ä¹ˆé—®é¢˜æ¥äº†

Node.js æä¾›çš„è¿™äº› bindings æˆ‘ä»¬å¯ä»¥ç”¨çš„ï¼Œä½†æ˜¯å¦‚æœæœ‰ä¸€ä¸ªæ–°çš„ C++åº“ï¼Œå¦‚ xxx å†™çš„å…³äºåŒºå—é“¾çš„åº“ï¼Œè€Œ Node.js å¹¶å’©æœ‰æŠŠè¿™ä¸ªåº“ binding è¿›æ¥ï¼Œä½ è¯´æˆ‘ä»¬è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ

æ‰€ä»¥ Node.js å°±æä¾›äº†è¿™ä¹ˆä¸€ä¸ªèƒ½åŠ›â€”â€”ä½ å¯ä»¥è‡ªå·±å†™ C++ï¼Œç„¶åæŠŠè¿™äº› C++ç»‘å®šåˆ° JS ä¸Šï¼Œç„¶å JS å°±å¯ä»¥è°ƒç”¨è¿™äº› C++åº“äº†

å½“ç„¶ï¼Œå¤§éƒ¨åˆ† Node.js ç¨‹åºå‘˜æ˜¯ä¸ä¼šè¿™ä¸€å—çš„ï¼Œå³ä¸ä¼šä¸º Node.js è‡ªå®šä¹‰å…¶å®ƒçš„èƒ½åŠ›ï¼

> äº†è§£ä¸€ä¸‹å³å¯ï¼Œå¦‚æœæŸä¸€å¤©ä½ çªç„¶å‘ç°è‡ªå·±å¥½åƒå¾—è¦å»å­¦ C++ï¼Œé‚£ä¹ˆä½ å°±å¥½å¥½çœ‹ä¸€ä¸‹è¿™å—å†…å®¹å‘—ï¼
> 
> è‡ªå·±å†™çš„ C++ ï¼Œæ˜¯ä¸éœ€è¦ç”¨ Node.js æä¾›çš„ç¼–è¯‘å·¥å…·ï¼Œç¼–è¯‘ä¸€ä¸‹ï¼Œç„¶åå†ä½¿ç”¨ï¼Ÿ

æ¥ä¸‹æ¥ï¼Œçœ‹çœ‹ Node.js çš„å·¥ä½œæµç¨‹â€¦â€¦

## â˜…Node.js å·¥ä½œæµç¨‹

![Node.js å·¥ä½œæµç¨‹](assets/img/2020-08-12-21-41-26.png)

## â˜…Node.js `v0.10.0` çš„ deps ç›®å½•

![0.10 çš„ deps ç›®å½•](assets/img/2020-08-12-21-42-53.png)

- deps ç›®å½•ï¼šåœ¨ç¨‹åºé‡Œï¼Œä¸€èˆ¬æŒ‡çš„æ˜¯æ‰€æœ‰ä¾èµ–â€¦â€¦

Node.js ä¾èµ–äº† 7 ä¸ª C/C++åº“ -> **åªéœ€è¦çŸ¥é“ ã€Œv8ã€å’Œã€Œuvã€(libuv) è¿™ä¸¤ä¸ªåº“å°±è¡Œäº†**ï¼å…¶å®ƒçš„åº“ï¼Œåªéœ€è¦äº†è§£æ˜¯å¹²å˜›çš„å°±è¡Œäº†ï¼Œå¦‚ã€Œzlibã€æ˜¯ä¸“é—¨ç”¨æ¥åšå‹ç¼©ç”¨çš„â€¦â€¦

ç°åœ¨æœ€æ–°ç‰ˆçš„ï¼ˆ`v14.8.0`ï¼‰ï¼š

![v14.8.0](assets/img/2020-08-12-21-47-48.png)

## â˜…libuv & v8 çš„åŠŸèƒ½

1ï¼‰libuv æ˜¯ä»€ä¹ˆï¼Ÿ

![libuv æ˜¯ä»€ä¹ˆ](assets/img/2020-08-12-22-41-50.png)

libuv -> lib æ˜¯å‰ç¼€ï¼Œåº“åå«ã€Œuvã€(Unicorn Velociraptorâ€”ç‹¬è§’ä¼¶ç›—é¾™ï¼‰

![uv](assets/img/2020-08-12-23-18-50.png)

libuv æ˜¯æ€æ ·è¯ç”Ÿçš„ï¼Ÿ

è¯ç”Ÿçš„èƒŒæ™¯ï¼š

Ryan èµ·åˆæƒ³æä¸€ä¸ªåŸºäºäº‹ä»¶é©±åŠ¨ã€éé˜»å¡ I/O çš„ Web æœåŠ¡å™¨ï¼ˆä¹Ÿå« Web å¤„ç†ç¨‹åºï¼‰ï¼Œä»¥è¾¾åˆ°æ›´é«˜çš„æ€§èƒ½ï¼Œæä¾› Apache ç­‰æœåŠ¡å™¨ä¹‹å¤–çš„é€‰æ‹©ã€‚

Ryan å‘ç°æ¯ä¸ªå¹³å°æ——ä¸‹éƒ½æœ‰å„è‡ªçš„ å¼‚æ­¥ I/O åº“ï¼Œæ‰€ä»¥ Ryan è§‰å¾—è‡ªå·±å’©æœ‰å¿…è¦ä¸ºæ¯ä¸ªå¹³å°éƒ½å†™ä¸€ä¸ª Node.js 

äºæ˜¯ï¼ŒRyan ç‰¹åˆ«æœºæ™ºçš„å°±æŠŠè¿™äº›å¼‚æ­¥ I/O åº“æ•´åˆåˆ°ä¸€èµ·ï¼Œç„¶åå†™äº†ä¸€ä¸ªåº“ï¼Œè€Œè¿™ä¸ªåº“å°±æ˜¯ã€Œlibuvã€ -> ç›®çš„æ˜¯ã€Œå†™ä¸€ä¸ª**è·¨å¹³å°**çš„å¼‚æ­¥ I/O åº“ã€

è¯è¯´ï¼Œã€ŒI/Oã€æ˜¯ä»€ä¹ˆï¼Ÿ

æ‰€æœ‰çš„è¾“å…¥ã€è¾“å‡ºéƒ½å±äº I/Oï¼Œå¦‚ï¼š

- å†™æ–‡ä»¶ -> ä½ ä»ä½ çš„æ“ä½œç³»ç»Ÿä¸Šå†™æ–‡ä»¶å†™åˆ°ç¡¬ç›˜ä¸Š
- è®¿é—®ç½‘ç»œ -> ä½ ä»ä½ çš„æ“ä½œç³»ç»Ÿå‘å‡ºæ•°æ®åˆ°åˆ«äººçš„æœåŠ¡å™¨ä¸Š
- æ‰“å°æ–‡æ¡£ -> è¿æ¥æ‰“å°æœºï¼Œå‘ä»½æ–‡æ¡£ç»™æ‰“å°æœºæ‰“å°
- â€¦â€¦

åªè¦æ˜¯è¾“å…¥æˆ–è€…è¾“å‡ºéƒ½å±äº I/O æ“ä½œï¼ä¹Ÿå°±æ˜¯è¯´**ç³»ç»Ÿè·Ÿå…¶å®ƒçš„å¤–ç•Œè¿›è¡Œäº¤äº’çš„æ‰€æœ‰åŠŸèƒ½éƒ½æ˜¯ I/O** -> å¦‚`readFile()`è¿™ä¸ªåŠŸèƒ½ä¸æ–‡ä»¶ç³»ç»Ÿæ‰“äº¤é“ï¼Œæ‰€ä»¥è¿™æ˜¯ I/O æ“ä½œï¼

---

libuv ä¼šæ ¹æ®å½“å‰ç³»ç»Ÿè‡ªåŠ¨é€‰æ‹©å·²ç»å®ç°å¥½çš„ å¼‚æ­¥ I/O åº“ï¼

libuv çš„ä¸»è¦åŠŸèƒ½ï¼ˆæ‰€ä»¥çš„åŠŸèƒ½éƒ½æ˜¯å¼‚æ­¥çš„ï¼‰ï¼š

- å¯ä»¥æ“ä½œ TCP -> æœ‰å•¥ç”¨ï¼Ÿ -> æˆ‘ä»¬çŸ¥é“ HTTP æ˜¯åŸºäº TCP/IP çš„ï¼Œæ‰€ä»¥åªè¦èƒ½æ“ä½œ TCPï¼Œæˆ‘ä»¬å°±å¯ä»¥åš HTTP çš„æœåŠ¡å™¨
- æ“ä½œ UDP -> ä¸€èˆ¬èŠå¤©ï¼Œå¦‚ QQ èŠå¤©éƒ½æ˜¯åŸºäº UDP çš„ï¼Œè™½ç„¶å¯èƒ½ä¼šä¸¢åŒ…ï¼Œä½†ä¸éœ€è¦ä¸‰æ¬¡æ¡æ‰‹ä»€ä¹ˆçš„ï¼Œæ‰€ä»¥å³ä¾¿ä¸é‚£ä¹ˆç¨³ï¼Œä½†æ•ˆç‡è¿˜æ˜¯æ¯”è¾ƒé«˜çš„ï¼
- è§£æ DNS -> è§£æ baidu.com å¯¹åº”å“ªä¸ª ipï¼Œä¸ç„¶æ€ä¹ˆçŸ¥é“è¯¥å‘å“ªä¸ªæœåŠ¡å™¨å‘èµ·è¯·æ±‚å‘¢ï¼Ÿ
- æ“ä½œæ–‡ä»¶ -> è¯»æ–‡ä»¶ã€å†™æ–‡ä»¶ç­‰è¿™äº›æ“ä½œï¼Œlibuv éƒ½å¯ä»¥å¸®æˆ‘ä»¬ç®¡ç†ï¼
- â€¦â€¦

æœ‰äº†è¿™äº›åŠŸèƒ½ï¼ŒNode.js å°±å¯ä»¥æ‘†è„± I/O ç“¶é¢ˆï¼Œå³** I/O å…¨éƒ½äº¤ç»™ C/C++æ¥åš**ï¼Œæˆ‘ JS ä¸€æ¦‚ä¸ç®¡è¿™äº›åŠŸèƒ½â€¦â€¦æˆ‘ JS åªè´Ÿè´£åšä¸€äº›ç®€å•çš„å¦‚è°ƒç”¨ä¹‹ç±»çš„ä¸œè¥¿

> ä¸éœ€è¦å»çœ‹ libuv çš„æºä»£ç â€¦â€¦

2ï¼‰V8 æ˜¯ä»€ä¹ˆï¼Ÿ

![V8](assets/img/2020-08-12-23-55-44.png)

V8 æ˜¯ä½œè€…å†™çš„ç¬¬ 8 ä¸ªè™šæ‹Ÿæœºï¼Ÿ

> V8 æ˜¯ä¸€ä¸ªç”± Google å¼€å‘çš„å¼€æº JavaScript å¼•æ“ï¼Œç”¨äº Google Chrome åŠ Chromium ä¸­ã€‚Lars Bak æ˜¯è¿™ä¸ªé¡¹ç›®çš„ç»„é•¿ï¼Œä»¥ V8 å‘åŠ¨æœºä¸ºå…¶å‘½å -> å®ƒä¹Ÿè¢«ç”¨äºæœåŠ¡å™¨ç«¯ï¼Œä¾‹å¦‚ Couchbaseã€MongoDB å’Œ Node.js
> 
> V8 å¼•æ“æ˜¯ä¸€ä¸ª JavaScript å¼•æ“å®ç°ï¼Œæœ€åˆç”±ä¸€äº›è¯­è¨€æ–¹é¢ä¸“å®¶è®¾è®¡ï¼Œåè¢«è°·æ­Œæ”¶è´­ï¼Œéšåè°·æ­Œå¯¹å…¶è¿›è¡Œäº†å¼€æºï¼Ÿ
> 
> V8 å°† JS ä»£ç ç¼–è¯‘æˆ**åŸç”Ÿæœºå™¨ç **ï¼ˆIA-32, x86-64, ARM, or MIPS CPUsï¼‰ï¼Œå¹¶ä¸”ä½¿ç”¨äº†å¦‚å†…è”ç¼“å­˜ï¼ˆinline cachingï¼‰ç­‰æ–¹æ³•æ¥æé«˜æ€§èƒ½ã€‚æœ‰äº†è¿™äº›åŠŸèƒ½ï¼ŒJavaScript ç¨‹åºåœ¨ V8 å¼•æ“ä¸‹çš„è¿è¡Œé€Ÿåº¦åª²ç¾äºŒè¿›åˆ¶ç¨‹åºã€‚

å®ƒæœ‰å“ªäº›åŠŸèƒ½ï¼Ÿ

- JS æºä»£ç  -> V8 å¼•æ“ -> æœºå™¨ä»£ç ï¼ˆ`0101101â€¦â€¦`ï¼‰ã€Œè®¡ç®—æœºçœ‹åˆ°è¿™äº›ä»£ç å°±å¯ä»¥ç›´æ¥æ‰§è¡Œï¼Œä¸éœ€è¦å†å€ŸåŠ©ä»»ä½•çš„å…¶å®ƒå·¥å…·äº†ï¼Œå°±å¥½åƒæˆ‘ä»¬åœ¨ windows é‡Œè¾¹åŒå‡»ä¸€ä¸ª `xx.exe`æ–‡ä»¶ï¼Œç„¶åå¼¹å‡ºä¸€ä¸ªæ¡†ä¸€æ ·ï¼Œæ‰€ä»¥å®ƒæ˜¯éå¸¸é«˜æ•ˆçš„ï¼Œç›®å‰ V8 æ˜¯å•†ç”¨é‡Œè¾¹æ‰§è¡Œæœ€å¿«çš„è¿™ä¹ˆä¸€ä¸ª JS å¼•æ“ã€
- ç»´æŠ¤ Call Stack -> è¿™ä¸æ˜¯ JS è‡ªå·±ç»´æŠ¤çš„ï¼Œè€Œæ˜¯æ‰€è¿è¡Œçš„è¿™ä¸ª V8 å¼•æ“ç»´æŠ¤çš„
- è´Ÿè´£å†…å­˜ç®¡ç† -> ä½  `new Xxx()`ï¼Œè¿™ä¸ªå¯¹è±¡è¢«å­˜åœ¨å“ªä¸ªæ—®æ—¯æ˜¯ V8 å¼•æ“å†³å®šçš„â€¦â€¦
- è¾£é¸¡å›æ”¶ -> æ˜¯ä¸ºäº†ã€Œé‡å¤åˆ©ç”¨ã€ï¼Œè€Œä¸æ˜¯ã€ŒæŠŠæ— ç”¨çš„ç»™æ¸…äº†ã€â€¦â€¦ -> å†…å­˜æ˜¯æœ‰é™çš„ï¼Œå¿…é¡»åšè¾£é¸¡å›æ”¶ï¼Œå¦‚ä½ ç”¨äº† 2K å†…å­˜ï¼Œé‚£ä¹ˆä½ ç”¨å®Œäº†å°±å¾—è¿˜ç»™æˆ‘ï¼Œå› ä¸ºæˆ‘è¿˜å¾—ç»™ä¸‹ä¸€ä¸ªç¨‹åºç”¨å‘¢ï¼ -> æ€»ä¹‹è¾£é¸¡å›æ”¶çš„ç›®çš„æ˜¯ä¸ºäº†**é‡å¤åˆ©ç”¨å†…å­˜**ï¼Œè€Œä¸æ˜¯ç”¨äº†ä¸€æ¬¡ï¼Œå°±æ­»åœ¨é‚£å„¿äº†â€¦â€¦å°±åƒæ˜¯ä¸Šå•æ‰€é‚£æ ·ï¼Œä½ æ€»ä¸èƒ½æŠŠè¿™ä¸ªå‘ä¸€ç›´è¹²åˆ°ä¸–ç•Œæœ«æ—¥å§â€¦â€¦
- V8 è¿˜è¦å®ç° JS çš„å„ç§æ ‡å‡†åº“ï¼Œå¦‚æ•°ç»„é‡Œçš„`sort/map/filter/reduce`ç­‰å‡½æ•°ï¼Œè¿™äº›å‡½æ•°éƒ½è¦ V8 è‡ªå·±å®ç°å¥½ï¼Œä¸ç„¶ï¼ŒJS å°±è°ƒç”¨ä¸äº†äº†ï¼Œæ‰€ä»¥ V8 çš„åŠŸèƒ½æ˜¯éå¸¸å¤šçš„â€¦â€¦

è¯è¯´ï¼ŒV8 æœ‰è¿™ä¹ˆå¤šåŠŸèƒ½ï¼Œé‚£ä¹ˆå®ƒæ˜¯å¤šçº¿ç¨‹çš„å—ï¼Ÿ

æ˜¯çš„ï¼Œå®ƒæ˜¯å¤šçº¿ç¨‹çš„ï¼Œå¦‚ï¼š

- å®ƒå¼€ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ JS
- å¼€ä¸€ä¸ªçº¿ç¨‹æ¸…ç†å†…å­˜
- å¼€ä¸€ä¸ªçº¿ç¨‹ç®¡ç†å…¶å®ƒçš„ä¸œè¥¿
- â€¦â€¦

æ€»ä¹‹ï¼ŒV8 æœ¬èº«æ˜¯å¤šçº¿ç¨‹çš„

æ³¨æ„ï¼š

- V8 ä¸æä¾› DOM API -> è¿™ DOM API æ˜¯æµè§ˆå™¨æä¾›çš„
- V8 æ‰§è¡Œ JS çš„è¿‡ç¨‹æ˜¯å•çº¿ç¨‹çš„ï¼Œæ³¨æ„ï¼Œ**åªæ˜¯æ‰§è¡Œ JS æ˜¯å•çº¿ç¨‹çš„**ï¼å®ƒçš„å†…å­˜ç®¡ç†æ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼Œè¾£é¸¡å›æ”¶å¯èƒ½æ˜¯å¦ä¸€ä¸ªçº¿ç¨‹ -> V8 æœ¬èº«æ˜¯å¤šçº¿ç¨‹çš„ï¼Œå¯ä¸æ˜¯å•çº¿ç¨‹çš„ï¼
- ç†è®ºä¸Šï¼Œå¯ä»¥å¼€ä¸¤ä¸ªçº¿ç¨‹åˆ†åˆ«æ‰§è¡Œ JSï¼Œè¿™æ ·ä¸€æ¥å°±æ˜¯å¤šçº¿ç¨‹æ‰§è¡Œ JS äº†å‘€ï¼ä½†è¿™å¹¶ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„å¤šçº¿ç¨‹ï¼Œåªæ˜¯å¼€äº†ä¸¤ä¸ªä¸œè¥¿å»è·‘ JS è€Œå·²ï¼Œè€Œè¿™ä¸¤ä¸ª JS æ¯«æ— ç“œè‘›â€¦â€¦
- è¾£é¸¡å›æ”¶éå¸¸å¤æ‚ï¼Œå¯èƒ½ä¸æ­¢ä¸€ä¸ªå•ç‹¬çº¿ç¨‹â€¦â€¦
- V8 å¤©ç”Ÿè‡ªå¸¦ event loopï¼Œæˆ‘ä»¬è¦ç”¨å®ƒçš„ event loop æ˜¯å’©æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯ Node.js å¹¶å’©æœ‰ç”¨å®ƒçš„ï¼Œè€Œæ˜¯è‡ªå·±åŸºäº libuv è‡ªå·±åšäº†ä¸€ä¸ª event loop -> æ€»ä¹‹ï¼ŒV8 æœ‰ event loopï¼Œä½† Node.js å¹¶æ²¡æœ‰ç”¨ï¼Œè€Œæ˜¯è‡ªå·±é€ äº†ä¸€ä¸ª

> çŸ¥è¯†ç‚¹ï¼šçŸ¥é“ v8 çš„åŠŸèƒ½ä»¥åŠ V8 æ˜¯ä¸æ˜¯å•çº¿ç¨‹çš„ï¼Ÿ

> æµè§ˆå™¨çš„äº‹ä»¶å¾ªç¯æ˜¯ V8 æä¾›çš„ï¼Ÿ -> æµè§ˆå™¨çš„äº‹ä»¶å¾ªç¯æ ‡å‡†æ˜¯ç”± HTML æ ‡å‡†è§„å®šçš„ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯ç”± whatwg è§„å®šçš„

---

æ¥ä¸‹æ¥çœ‹çœ‹ã€Œä»€ä¹ˆæ˜¯ event loopï¼Ÿã€

## â˜…EventLoop ç®€å•ä»‹ç»
